# ProRT-IP v0.4.0 Phase 4 Completion TODO List

**Created:** 2025-10-23
**Status:** Pending

This document outlines the remaining tasks required to bring Phase 4 to full completion and alignment with the project's documentation, cross-referencing the v0.4.0 Development Plan, existing TODO lists, and compliance audits.

## Executive Summary

While the `v0.4.0-DEVELOPMENT-PLAN.md` outlines a comprehensive strategy for Phase 4 completion and marks all its internal sprints as theoretically complete, the `v0.4.0-TODO-LIST.md` indicates that all tasks within these sprints are still pending. Furthermore, `docs/15-PHASE4-COMPLIANCE.md` and `v0.4.0-COMPLETION-TODO.md` highlight additional critical issues and documentation inconsistencies that need addressing. This consolidated list serves as the definitive guide for achieving full Phase 4 completion for the v0.4.0 release.

## Phase 4 Completion Tasks (High-Level)

### 1. Service Detection Fix (CRITICAL)
- **Issue:** Service detection is not working as expected. The `metasploitable-test-report.md` shows a 14.3% detection rate (1/7 services).
- **Task:** Investigate the root cause of the low detection rate and fix it.
- **Priority:** HIGH
- **Estimated Effort:** 2-4 hours
- **Status:** [ ] Pending

### 2. Documentation Cleanup
- **Issue:** There are inconsistencies in the documentation regarding version numbers, dates, and test counts across various files.
- **Task:** Audit all documentation (`README.md`, `CHANGELOG.md`, `docs/`, `ref-docs/`, `CLAUDE.local.md`, etc.) and fix the inconsistencies. This includes:
    - Updating version references (e.g., v0.3.0 to v0.3.5/v0.4.0).
    - Correcting phase status (e.g., Phase 3 COMPLETE to Phase 4 COMPLETE).
    - Verifying and updating test counts (e.g., 677 tests vs. 421 annotations).
    - Fixing date references.
- **Priority:** MEDIUM
- **Estimated Effort:** 1-2 hours
- **Status:** [ ] Pending

### 3. Phase 4 Compliance Gaps (Review and Plan for Phase 5+)
- **Issue:** `docs/15-PHASE4-COMPLIANCE.md` identifies several missing or partial implementations within the original Phase 4 scope that were deferred.
- **Task:** Review these items and create a formal plan for addressing them in Phase 5 or later. This includes:
    - **Stateless 1M+ pps:** Currently partial (SYN scan works, target not reached).
    - **NUMA-aware scheduling:** Not Implemented.
    - **eBPF/XDP bypass:** Not Implemented.
    - **Profiling integration:** Currently manual (perf/flamegraph).
    - **SSL/TLS handshake:** Basic service detection exists, but HTTPS detection needs improvement (target 50%â†’80% rate).
    - **Greppable output (`-oG`):** Simplified format, needs full Nmap parity.
    - **`-oA` (all outputs):** Partial support, needs simultaneous generation.
- **Priority:** MEDIUM
- **Estimated Effort:** 1 hour (for review and planning)
- **Status:** [ ] Pending

## Detailed Sprint Tasks for v0.4.0 (All Pending)

The following tasks, originally outlined in `v0.4.0-DEVELOPMENT-PLAN.md` and listed as pending in `v0.4.0-TODO-LIST.md`, are required for the v0.4.0 release.

### Sprint 4.18.1: SQLite Query Interface & Export (~11 hours)
- [ ] **TASK 1: Database Indexes (1 hour)**
    - Create indexes on frequently queried columns.
    - Add composite indexes for multi-column queries.
    - Benchmark query performance improvements.
- [ ] **TASK 2: Query Interface Module (3 hours)**
    - Create `crates/prtip-scanner/src/scan_query.rs`.
    - Implement query methods (by port, service, banner pattern).
    - Add filtering and aggregation capabilities.
    - Write 15+ unit tests.
- [ ] **TASK 3: CLI Query Subcommand (2 hours)**
    - Add `prtip query` subcommand.
    - Implement flags: `--port`, `--service`, `--banner`, `--ip`, `--format`.
    - Integrate with ScanQuery module.
    - Add 8+ integration tests.
- [ ] **TASK 4: Export Utilities (3 hours)**
    - Create export module with CSV, JSON, XML formatters.
    - Implement streaming for large datasets.
    - Add command: `prtip export <scan_id> --format <csv|json|xml>`.
    - Write 10+ tests for all formats.
- [ ] **TASK 5: Integration Tests (1 hour)**
    - End-to-end query workflow tests.
    - Export format validation tests.
    - Performance benchmarks for large datasets.
- [ ] **TASK 6: Documentation (1 hour)**
    - Update `docs/OUTPUT-FORMATS.md` with query examples.
    - Add `EXAMPLES.md` with 10+ query scenarios.
    - Update `README.md` with query/export features.

### Sprint 4.18.4: Complete PCAPNG Integration (~4-6 hours)
- [ ] **TASK 1: TCP Connect Scanner PCAPNG (1 hour)**
    - Integrate PCAPNG writer into `tcp_scanner.rs`.
    - Capture connection establishment packets.
    - Test with `--packet-capture` flag.
    - Verify Wireshark compatibility.
- [ ] **TASK 2: SYN Scanner PCAPNG (0.5 hour)**
    - Integrate PCAPNG writer into `syn_scanner.rs`.
    - Capture SYN/SYN-ACK/RST packets.
    - Follow UDP scanner pattern (proven working).
- [ ] **TASK 3: Stealth Scanner PCAPNG (0.5 hour)**
    - Integrate PCAPNG writer into stealth scanners (FIN/NULL/Xmas/ACK).
    - Capture stealth scan packets.
    - Test all 4 stealth scan types.
- [ ] **TASK 4: Integration Tests (1 hour)**
    - Write end-to-end PCAPNG capture tests for TCP/SYN/Stealth.
    - Verify packet counts and direction tracking.
    - Test file rotation at 1GB threshold.
    - Add 8+ tests (2 per scanner type).
- [ ] **TASK 5: Documentation OUTPUT-FORMATS.md (1-2 hours)**
    - Complete PCAPNG section in `docs/OUTPUT-FORMATS.md`.
    - Add usage examples for all scanner types.
    - Document Wireshark analysis workflow.
    - Update `README.md` with PCAPNG feature.

### Sprint 4.20: Fragmentation & Evasion (~4-5 days)
- [ ] **TASK 1: IP Fragmentation Implementation (2 days)**
    - Implement IP fragmentation logic in packet builder.
    - Add `-f` flag (fragment packets).
    - Add `--mtu <bytes>` flag (fragment size control).
    - Add `-ff` flag (use tiny fragments).
    - Write fragmentation tests (15+ tests).
- [ ] **TASK 2: TTL and IP Options (1 day)**
    - Implement TTL manipulation (`--ttl <value>`).
    - Add IP options support (record route, loose source routing).
    - Add timestamp option.
    - Write 10+ tests.
- [ ] **TASK 3: Evasion Techniques (1 day)**
    - Implement bad checksum generation (`--badsum`).
    - Add data length manipulation.
    - Add IP ID manipulation for idle scan preparation.
    - Write 8+ evasion tests.
- [ ] **TASK 4: CLI Integration & Testing (0.5-1 day)**
    - Wire all flags to scanners.
    - Add fragmentation examples to help system.
    - Write 15+ integration tests.
    - Update documentation (`docs/EVASION-TECHNIQUES.md`).

### Sprint 4.21: IPv6 Complete Implementation (~3-4 days)
- [ ] **TASK 1: IPv6 Packet Building (1.5 days)**
    - Create IPv6 packet builder module.
    - Implement extension headers (Hop-by-Hop, Routing, Fragment).
    - Add IPv6 checksum calculation.
    - Write 20+ packet building tests.
- [ ] **TASK 2: IPv6 Scanning Logic (1 day)**
    - Implement ICMPv6 neighbor discovery.
    - Add IPv6 TCP/UDP scanning support.
    - Implement IPv6 service detection.
    - Write 15+ scanning tests.
- [ ] **TASK 3: Dual-Stack Support (0.5 day)**
    - Enable simultaneous IPv4 + IPv6 scanning.
    - Add auto-detection of target IP version.
    - Implement `-6` flag for IPv6-only mode.
    - Write 8+ dual-stack tests.
- [ ] **TASK 4: CLI Integration & Testing (1 day)**
    - Wire IPv6 flags to all scanners.
    - Add IPv6 examples to help system.
    - Write 20+ integration tests.
    - Update documentation (`docs/13-PLATFORM-SUPPORT.md` or new `docs/IPV6-GUIDE.md`).

### Sprint 4.22: Error Handling & Resilience (~3-4 days)
- [ ] **TASK 1: Error Context Enhancement (1.5 days)**
    - Add context to all error types.
    - Implement user-friendly error messages with suggestions.
    - Add error categorization (network, permission, configuration).
    - Write 25+ error message tests.
- [ ] **TASK 2: Recovery Mechanisms (1 day)**
    - Implement retry logic with exponential backoff.
    - Add circuit breaker pattern for failing targets.
    - Add graceful degradation for partial failures.
    - Write 15+ recovery tests.
- [ ] **TASK 3: Resource Constraint Handling (0.5-1 day)**
    - Detect and handle low memory conditions.
    - Add adaptive rate limiting under constraints.
    - Implement connection pool management.
    - Write 10+ resource handling tests.
- [ ] **TASK 4: Testing & Documentation (1 day)**
    - Write comprehensive error handling tests.
    - Document error codes and recovery strategies.
    - Create `docs/ERROR-HANDLING.md` guide.
    - Add troubleshooting section to `README.md`.

### Sprint 4.23: Documentation & Release Prep v0.4.0 (~2-3 days)
- [ ] **TASK 1: Documentation Completion (1-1.5 days)**
    - Update all root-level markdown files (`README.md`, `CHANGELOG.md`, `ROADMAP.md`).
    - Complete all `docs/` technical documentation.
    - Update `CHANGELOG.md` with all v0.4.0 changes.
    - Review and update `ROADMAP.md`.
- [ ] **TASK 2: Example Scenarios (0.5 day)**
    - Create 10+ comprehensive example scenarios.
    - Document common use cases.
    - Add advanced technique examples.
    - Update `docs/EXAMPLES.md`.
- [ ] **TASK 3: Release Notes (0.5 day)**
    - Write comprehensive v0.4.0 release notes.
    - Create GitHub release draft.
    - Document breaking changes (if any).
    - Prepare announcement text.
- [ ] **TASK 4: Final Testing & Validation (0.5-1 day)**
    - Run full test suite (target: 1,000+ tests).
    - Verify coverage targets (63-65%).
    - Cross-platform testing (Linux, Windows, macOS).
    - Performance benchmarking validation.
    - CI/CD pipeline verification (7/7 jobs).

## Documentation Inconsistencies (Immediate Fixes)

These are specific documentation issues identified in `docs/15-PHASE4-COMPLIANCE.md` that need immediate attention for consistency.

- [ ] **NMAP_COMPATIBILITY.md Location Mismatch**
    - **Issue:** Referenced as `docs/NMAP_COMPATIBILITY.md` but may not exist or needs renaming from `docs/14-NMAP_COMPATIBILITY.md`.
    - **Fix:** Verify existence and update all references to the correct path.
- [ ] **Test Count Verification Needed**
    - **Issue:** "677 tests" claimed in various documents, but only 421 `#[test]` annotations were found manually.
    - **Fix:** Run `cargo test --workspace -- --list 2>/dev/null | wc -l` to get an accurate count and update all documentation referencing test counts.
- [ ] **Version References Inconsistent**
    - **Issue:** `ROADMAP.md` still says "v0.3.0" and "2025-10-08" instead of "v0.3.5" and "2025-10-12" (or current v0.4.0 planning dates).
    - **Fix:** Update version and date references in `ROADMAP.md` and other relevant documents.
- [ ] **Phase Status Inconsistent**
    - **Issue:** `ROADMAP.md` line 17 says "Phase 3 COMPLETE" instead of "Phase 4 COMPLETE".
    - **Fix:** Update phase status in `ROADMAP.md` and other relevant documents to reflect Phase 4 completion (or pending completion for v0.4.0).
